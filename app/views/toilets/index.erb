<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Skip To My Loo</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>

<body>
<%= erb :_sidebar_partial %>
<div id='map'></div>
<script>
L.mapbox.accessToken = ENV['accessToken'];
var map = L.mapbox.map('map', 'rsinclairchin.o8p4f1ph');

map.on('style.load', function () {
    map.addSource("markers", {
        <% @geojson.each do |geojson| %>
        "type": "geojson",
        "data": {
            "type": "FeatureCollection",
            "features": [<%= geojson %>]
        <%end%>
    });

    map.addLayer({
        "id": "markers",
        "type": "symbol",
        "source": "markers",
        "layout": {
            "icon-image": "{marker-symbol}-15",
            "text-field": "{title}",
            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
            "text-offset": [0, 0.6],
            "text-anchor": "top"
        },
        "paint": {
            "text-size": 12
        }
    });
});

</script>


</body>
</html>

